% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_sd.R
\name{simulate_function_sd}
\alias{simulate_function_sd}
\title{Monte Carlo simulation of patient diameter statistic under measurement uncertainty}
\usage{
simulate_function_sd(
  df_patient,
  FUN = NULL,
  sdUS = 3.5,
  sdCT = 1.9,
  n_sim = 100,
  seed = NULL,
  min_diam = 15,
  max_diam = 150
)
}
\arguments{
\item{df_patient}{A \code{data.frame} with columns:
\itemize{
\item \code{Date}: Numeric time points (e.g., years or days)
\item \code{Diam}: Measured diameters (numeric)
\item \code{CT}: Indicator of imaging modality (1 = CT, 0 = Ultrasound; may be factor or numeric)
}}

\item{FUN}{A function of the form \code{FUN(Date, Diam)} returning a numeric scalar.
Defines the statistic to be computed for each simulated dataset.
If \code{NULL}, defaults to the slope from a simple linear regression of
\code{Diam ~ Date}.}

\item{sdUS}{Numeric. Standard deviation of Ultrasound measurement error. Notice that you need to be consistent with the measurement units with Diam.
Default: 3.5.}

\item{sdCT}{Numeric. Standard deviation of CT measurement error. Notice that you need to be consistent with the measurement units with Diam.
Default: 1.9.}

\item{n_sim}{Integer. Number of Monte Carlo simulation iterations.
Default: 100.}

\item{seed}{Optional integer. Random seed for reproducibility.
Default: \code{NULL}.}

\item{min_diam}{Numeric. Minimum physically plausible diameter.
Values below this are truncated. Default: 15.}

\item{max_diam}{Numeric. Maximum physically plausible diameter.
Values above this are truncated. Default: 150.}
}
\value{
A list with elements:
\itemize{
\item \code{mean}: Mean of the simulated statistic across valid simulations.
\item \code{sd}: Standard deviation of the simulated statistic.
\item \code{n_valid}: Number of valid simulations.
}
}
\description{
Performs a Monte Carlo simulation to estimate the mean and standard deviation
of a user-defined statistic (by default, the slope of a linear regression of
diameter vs. time), accounting for measurement error specific to imaging modality
(Ultrasound or CT). Each simulation perturbs observed diameters according to
assumed normal measurement error distributions and evaluates the chosen statistic.
}
\details{
For each simulation, diameters are perturbed using a normal distribution with
standard deviation determined by the imaging modality (\code{sdUS} or \code{sdCT}).
The provided function \code{FUN} is evaluated on each perturbed dataset. Simulations
producing non-finite results are excluded from the final summary.
}
\examples{
df <- data.frame(
  Date = c(2015, 2016, 2017, 2018),
  Diam = c(30, 34, 33, 36),
  CT   = c(0, 1, 0, 1)
)

# Default usage: slope of linear regression of Diam ~ Date
res1 <- simulate_function_sd(df)

# Custom statistic: mean diameter
res2 <- simulate_function_sd(df, FUN = function(d, x) mean(x))

}
